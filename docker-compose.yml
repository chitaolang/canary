version: '3.8'

services:
  canary-worker:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: canary-worker
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      # map local move-decompiler to container
      - ./backend/move-decompiler:/app/move-decompiler:ro
      # map move-decompiler-prompt to container
      - ./backend/move-decompile-refactor-prompt-en.md:/app/move-decompile-refactor-prompt-en.md:ro
      # map working directory (for temporary files)
      - ./backend/workspace:/app/workspace
      # map account.json to host (persist Sui address)
      - ./backend/account.json:/app/account.json
    environment:
      - RUST_LOG=${RUST_LOG:-info}
      - NODE_CRON_SCHEDULE=${NODE_CRON_SCHEDULE:-0 * * * *}
    # Node.js process runs periodically via cron (default: every hour)
    # Set NODE_CRON_SCHEDULE to customize the schedule (cron format)
    # Example: "*/30 * * * *" for every 30 minutes, "0 0 * * *" for daily at midnight

